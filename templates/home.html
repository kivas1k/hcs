{% extends "base.html" %}

{% block title %}–ì–ª–∞–≤–Ω–∞—è - –ñ–ö–• –°–µ—Ä–≤–∏—Å{% endblock %}

{% block content %}
<section class="hero">
    <h1>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É—á–µ—Ç–∞ –æ–±—Ä–∞—â–µ–Ω–∏–π</h1>
    <p>–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –≥—Ä–∞–∂–¥–∞–Ω —Å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º–∏ –ñ–ö–• —á–µ—Ä–µ–∑ –µ–¥–∏–Ω—ã–π —Ü–∏—Ñ—Ä–æ–≤–æ–π —Å–µ—Ä–≤–∏—Å</p>
    <div>
        {% if user.is_authenticated %}
            {% if user.role == 'staff' or user.role == 'admin' %}
                <a href="{% url 'appeals:staff_appeals' %}" class="btn btn-primary">
                    –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±—Ä–∞—â–µ–Ω–∏–π
                </a>
            {% else %}
                <a href="{% url 'appeals:create_appeal' %}" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –æ–±—Ä–∞—â–µ–Ω–∏–µ</a>
                <a href="{% url 'appeals:my_appeals' %}" class="btn btn-outline">–£–∑–Ω–∞—Ç—å —Å—Ç–∞—Ç—É—Å</a>
            {% endif %}
        {% else %}
            <a href="{% url 'users:login' %}" class="btn btn-primary">
                –í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É
            </a>
        {% endif %}
    </div>
</section>

<section class="features">
    <h2 style="text-align: center; margin-bottom: 2rem;">–ù–∞—à–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏</h2>
    <div class="features-grid">
        <div class="feature-card">
            <div class="feature-icon">üìù</div>
            <h3>–ü–æ–¥–∞—á–∞ –æ–±—Ä–∞—â–µ–Ω–∏–π</h3>
            <p>–ë—ã—Å—Ç—Ä–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –æ–±—Ä–∞—â–µ–Ω–∏–π —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π</p>
        </div>
        <div class="feature-card">
            <div class="feature-icon">üîç</div>
            <h3>–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞</h3>
            <p>–ü—Ä–æ–∑—Ä–∞—á–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤–∞—à–∏—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</p>
        </div>
        <div class="feature-card">
            <div class="feature-icon">üìä</div>
            <h3>–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏</h3>
            <p>–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ —É–¥–æ–±–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º</p>
        </div>
        <div class="feature-card">
            <div class="feature-icon">‚ùì</div>
            <h3>–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π</h3>
            <p>–û—Ç–≤–µ—Ç—ã –Ω–∞ —á–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã –ø–æ –≤—Å–µ–º –∞—Å–ø–µ–∫—Ç–∞–º –ñ–ö–•</p>
        </div>
        <div class="feature-card">
            <div class="feature-icon">üì±</div>
            <h3>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h3>
            <p>–°–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –≤–∞—à–∏—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π</p>
        </div>
        <div class="feature-card">
            <div class="feature-icon">‚≠ê</div>
            <h3>–û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞</h3>
            <p>–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ü–µ–Ω–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ñ–ö–•</p>
        </div>
    </div>
</section>

<section class="comments-section" style="margin-bottom: 80px;">
    <div class="container">
        {% if user.is_authenticated %}
        <div class="comment-form card-style">
            <h3>–û—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</h3>
            <form method="post">
                {% csrf_token %}
                <input type="hidden" name="form_type" value="new_comment">
                <div class="form-group">
                    <textarea name="text" class="form-control" rows="3"
                        placeholder="–û—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." required></textarea>
                </div>
                <button type="submit" class="btn btn-primary submit-btn">
                    –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                    <svg class="submit-icon" width="20" height="20" viewBox="0 0 24 24">
                        <path fill="currentColor" d="M2 21v-2h20v2H2zm3.9-4.8-1.4-1.4L12 6l7.5 7.8-1.4 1.4L12 9 5.9 16.2z"/>
                    </svg>
                </button>
            </form>
        </div>
        {% else %}
        <div class="auth-notice alert">
            <span class="alert-icon">‚ö†Ô∏è</span>
            <div class="alert-content">
                –ß—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞
                <a href="{% url 'users:login' %}" class="btn btn-outline">–≤–æ–π–¥–∏—Ç–µ</a>
                –≤ —Å–∏—Å—Ç–µ–º—É
            </div>
        </div>
        {% endif %}

        {% if user.is_staff and pending_comments %}
        <div class="moderation-panel mt-5">
            <h3 class="mb-3">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</h3>
            {% for comment in pending_comments %}
            <div class="comment pending">
                <div class="comment-header">
                    <span class="comment-author">{{ comment.author.username }}</span>
                    <span class="comment-date">{{ comment.created_at|date:"d.m.Y H:i" }}</span>
                    {% if comment.is_edited %}<span class="edited-badge">(—Ä–µ–¥.)</span>{% endif %}
                </div>
                <div class="comment-text">{{ comment.text }}</div>
                <div class="comment-actions mt-2">
                    <form method="post">
                        {% csrf_token %}
                        <input type="hidden" name="comment_id" value="{{ comment.id }}">
                        <button type="submit" name="action" value="approve" class="btn btn-icon approve">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M20 6L9 17l-5-5"/>
                            </svg>
                        </button>
                        <button type="submit" name="action" value="reject" class="btn btn-icon reject">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M18 6L6 18M6 6l12 12"/>
                            </svg>
                        </button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <div class="approved-comments mt-5">
            <h3>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h3>
            {% if comments %}
                {% for comment in comments %}
                <div class="comment approved" id="comment-{{ comment.id }}">
                    <div class="comment-header">
                        <span class="comment-author">{{ comment.author.username }}</span>
                        <span class="comment-date">{{ comment.created_at|date:"d.m.Y H:i" }}</span>
                        {% if comment.is_edited %}<span class="edited-badge">(—Ä–µ–¥.)</span>{% endif %}
                    </div>
                    <div class="comment-text">{{ comment.text }}</div>

                    {% if comment.author == user or user.is_staff %}
                    <div class="comment-actions">
                        <form method="post" class="d-inline">
                            {% csrf_token %}
                            <input type="hidden" name="form_type" value="delete_comment">
                            <input type="hidden" name="comment_id" value="{{ comment.id }}">
                            <button type="submit" class="btn btn-icon btn-danger"
                                onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π?')">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                </svg>
                            </button>
                        </form>

                        {% if comment.author == user %}
                        <button class="btn btn-icon btn-edit" data-comment-id="{{ comment.id }}">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/>
                            </svg>
                        </button>
                        {% endif %}
                    </div>

                    {% if comment.author == user %}
                    <form method="post" class="edit-comment-form" style="display: none;">
                        {% csrf_token %}
                        <input type="hidden" name="form_type" value="edit_comment">
                        <input type="hidden" name="comment_id" value="{{ comment.id }}">
                        <div class="form-group">
                            <textarea name="text" class="form-control" rows="3" required>{{ comment.text }}</textarea>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                            <button type="button" class="btn btn-outline cancel-edit"
                                    data-comment-id="{{ comment.id }}">–û—Ç–º–µ–Ω–∞</button>
                        </div>
                    </form>
                    {% endif %}
                    {% endif %}
                </div>
                {% endfor %}
            {% else %}
                <div class="empty-state">
                    <div class="empty-icon">üí¨</div>
                    <h3>–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</h3>
                    <p>–ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º, –∫—Ç–æ –æ—Å—Ç–∞–≤–∏—Ç –æ—Ç–∑—ã–≤!</p>
                </div>
            {% endif %}
        </div>
    </div>
</section>

<style>
.edit-comment-form {
    margin-top: 1rem;
    padding: 1rem;
    background: #f8f9fa;
    border-radius: 8px;
    border: 1px solid #eee;
}

.edit-comment-form .form-control {
    width: 100%;
    margin-bottom: 1rem;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
}

.form-actions {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
}

.btn-edit {
    background: none;
    border: none;
    padding: 4px;
    cursor: pointer;
}

.btn-edit:hover {
    opacity: 0.8;
}

.cancel-edit {
    padding: 8px 16px;
    background: #f0f0f0;
    border: 1px solid #ddd;
    border-radius: 4px;
    cursor: pointer;
}

.comment-actions {
    margin-top: 10px;
    display: flex;
    gap: 8px;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.btn-edit').forEach(button => {
        button.addEventListener('click', function() {
            const commentId = this.dataset.commentId;
            const comment = document.getElementById(`comment-${commentId}`);

            comment.querySelector('.comment-header').style.display = 'none';
            comment.querySelector('.comment-text').style.display = 'none';
            comment.querySelector('.comment-actions').style.display = 'none';
            comment.querySelector('.edit-comment-form').style.display = 'block';
        });
    });

    document.querySelectorAll('.cancel-edit').forEach(button => {
        button.addEventListener('click', function() {
            const commentId = this.dataset.commentId;
            const comment = document.getElementById(`comment-${commentId}`);

            comment.querySelector('.comment-header').style.display = 'flex';
            comment.querySelector('.comment-text').style.display = 'block';
            comment.querySelector('.comment-actions').style.display = 'flex';
            comment.querySelector('.edit-comment-form').style.display = 'none';
        });
    });
});
</script>

{% endblock %}