{% extends "base.html" %}

{% block title %}–ú–æ–∏ –æ–±—Ä–∞—â–µ–Ω–∏—è ‚Äî –ñ–ö–• –°–µ—Ä–≤–∏—Å{% endblock %}

{% block content %}
<div class="auth-form">
  {% if messages %}
  <div class="alert alert-success">
    <span class="alert-icon"></span>
    <div class="alert-content">
      {% for message in messages %}
        {{ message }}
      {% endfor %}
    </div>
  </div>
  {% endif %}

  <div class="filter-header">
    <h2>–ú–æ–∏ –æ–±—Ä–∞—â–µ–Ω–∏—è</h2>
    <div class="filter-controls">
      <form class="search-form" method="GET">
        <input type="text"
               name="search"
               placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é..."
               value="{{ search_query|default:'' }}"
               class="search-input">
        <button type="submit" class="btn btn-primary">–ù–∞–π—Ç–∏</button>
      </form>
      <div class="dropdown" onmouseover="showDropdown()" onmouseleave="hideDropdown()">
        <button class="btn btn-primary">
          –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å
          <span class="dropdown-arrow"></span>
        </button>
        <div class="dropdown-menu">
          <a class="dropdown-item" href="?filter_type=title">–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é</a>
          <a class="dropdown-item" href="?filter_type=id">–ü–æ –Ω–æ–º–µ—Ä—É</a>
          <a class="dropdown-item" href="?filter_type=date">–ü–æ –¥–∞—Ç–µ</a>
          {% if current_filter or search_query %}
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="?">–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  {% if appeals %}
    <div class="appeals-grid">
      {% for appeal in appeals %}
        <a href="{% url 'appeals:appeal_detail' appeal.id %}" class="appeal-cube">
          <div class="cube-header">
            <h3 class="cube-title">{{ appeal.title|truncatechars:40 }}</h3>
            <span class="cube-status {{ appeal.status }}">{{ appeal.get_status_display }}</span>
          </div>

          <div class="cube-meta">
            <div class="cube-meta-item">
              <svg width="16" height="16" viewBox="0 0 24 24">
                <path fill="currentColor" d="M12 2L2 7l10 5 10-5-10-5M2 17l10 5 10-5M2 12l10 5 10-5"/>
              </svg>
              –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: {{ appeal.get_priority_display }}
            </div>
          </div>

          <div class="cube-tags">
            {% for tag in appeal.tags.all %}
              <span class="tag-pill">{{ tag.name }}</span>
            {% endfor %}
          </div>

          <div class="cube-date">
            <svg width="16" height="16" viewBox="0 0 24 24">
              <path fill="currentColor" d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2m0 18c-4.4 0-8-3.6-8-8s3.6-8 8-8 8 3.6 8 8-3.6 8-8 8m-1-13h2v6h-2V7m0 8h2v2h-2v-2"/>
            </svg>
            {{ appeal.created_at|date:"d.m.Y H:i" }}
          </div>
        </a>
      {% endfor %}
    </div>
  {% else %}
    <div class="empty-state">
      <div class="empty-icon">üì≠</div>
      <h3>
        {% if search_query or current_filter %}
          –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
        {% else %}
          –û–±—Ä–∞—â–µ–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç
        {% endif %}
      </h3>
      <p>
        {% if search_query or current_filter %}
          –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞
        {% else %}
          –ù–∞—á–Ω–∏—Ç–µ —Å —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏—è
        {% endif %}
      </p>
      {% if not search_query and not current_filter %}
        <a href="{% url 'appeals:create_appeal' %}" class="btn btn-primary">
          –°–æ–∑–¥–∞—Ç—å –æ–±—Ä–∞—â–µ–Ω–∏–µ
        </a>
      {% endif %}
    </div>
  {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const dropdowns = document.querySelectorAll('.dropdown');

    dropdowns.forEach(dropdown => {
        const menu = dropdown.querySelector('.dropdown-menu');
        let timeoutId;

        dropdown.addEventListener('mouseenter', () => {
            clearTimeout(timeoutId);
            menu.style.display = 'block';
        });

        dropdown.addEventListener('mouseleave', () => {
            timeoutId = setTimeout(() => {
                menu.style.display = 'none';
            }, 300);
        });

        menu.addEventListener('mouseenter', () => clearTimeout(timeoutId));
        menu.addEventListener('mouseleave', () => {
            timeoutId = setTimeout(() => {
                menu.style.display = 'none';
            }, 300);
        });
    });
});
</script>

{% endblock %}