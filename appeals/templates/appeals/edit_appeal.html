{% extends "base.html" %}

{% block title %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞—â–µ–Ω–∏—è #{{ appeal.id }} ‚Äî –ñ–ö–• –°–µ—Ä–≤–∏—Å{% endblock %}

{% block content %}
<div class="auth-form create-appeal">
  {% if messages %}
  <div class="alert alert-success">
    <span class="alert-icon">‚úÖ</span>
    <div class="alert-content">
      {% for message in messages %}
        {{ message }}
      {% endfor %}
    </div>
    <a href="{% url 'appeals:my_appeals' %}" class="btn btn-outline">
      ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É
    </a>
  </div>
  {% endif %}

  <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞—â–µ–Ω–∏—è #{{ appeal.id }}</h2>
  <form method="post" enctype="multipart/form-data" class="appeal-form">
    {% csrf_token %}

    <div class="form-group card-style">
      <label for="{{ appeal_form.title.id_for_label }}">üìå –ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
      {{ appeal_form.title }}
      {{ appeal_form.title.errors }}
    </div>

    <!-- –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è full_name –∏ address -->
    <div class="form-group card-style">
      <label for="{{ appeal_form.full_name.id_for_label }}">üë§ –§–ò–û</label>
      {{ appeal_form.full_name }}
      {{ appeal_form.full_name.errors }}
    </div>

    <div class="form-group card-style">
      <label for="{{ appeal_form.address.id_for_label }}">üè† –ê–¥—Ä–µ—Å –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è</label>
      {{ appeal_form.address }}
      {{ appeal_form.address.errors }}
    </div>

    <div class="form-group card-style">
      <label for="{{ appeal_form.description.id_for_label }}">üìù –û–ø–∏—Å–∞–Ω–∏–µ</label>
      {{ appeal_form.description }}
      {{ appeal_form.description.errors }}
    </div>

    <div class="form-group card-style">
      <label>üè∑ –¢–µ–≥–∏ –æ–±—Ä–∞—â–µ–Ω–∏—è</label>
      <div class="tags-container">
        {% for checkbox in appeal_form.tags %}
          <label class="tag-button">
            {{ checkbox.tag }}
            <span class="custom-checkbox"></span>
            <span class="tag-label">{{ checkbox.choice_label }}</span>
          </label>
        {% endfor %}
      </div>
      {% if appeal_form.tags.errors %}
        <div class="alert alert-danger mt-2">
          {{ appeal_form.tags.errors }}
        </div>
      {% endif %}
    </div>

    {% if documents %}
    <div class="form-group card-style">
      <label>üìé –ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã</label>
      <div class="document-list">
        {% for document in documents %}
          <div class="document-item">
            <a href="{{ document.file.url }}" target="_blank" class="document-link">
              {{ document.file.name|slice:"15:"|truncatechars:30 }}
            </a>
            <a href="{% url 'appeals:delete_document' document.id %}"
               class="document-delete"
               onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç?')">‚úñ</a>
          </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <div class="form-group card-style file-upload">
      <label>üìé –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã</label>
      <div class="upload-area">
        <svg width="40" height="40" viewBox="0 0 24 24" class="upload-icon">
          <path fill="var(--primary)" d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm4 18H6V4h7v5h5v11z"/>
          <path fill="var(--primary)" d="M16 13h-3V10h-2v3H8l4 4 4-4z"/>
        </svg>
        <span class="upload-text">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</span>
        <input type="file" name="files" multiple class="file-input">
      </div>
    </div>

    <div class="form-actions">
      <button type="submit" class="btn btn-primary submit-btn">
        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
      </button>
      <a href="{% url 'appeals:appeal_detail' appeal.id %}" class="btn btn-outline">
        –û—Ç–º–µ–Ω–∞
      </a>
    </div>
  </form>
</div>

<style>
.tags-container {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  padding: 8px 0;
}

.tag-button {
  display: inline-flex;
  align-items: center;
  padding: 8px 16px;
  border: 2px solid #e0f5eb;
  border-radius: 20px;
  background: #f8fffb;
  cursor: pointer;
  transition: all 0.2s;
  user-select: none;
  position: relative;
}

.tag-button:hover {
  background: #e0f5eb;
}

.tag-button.active {
  background: var(--primary);
  border-color: var(--primary);
  color: white;
}

.tag-button input[type="checkbox"] {
  position: absolute;
  opacity: 0;
  width: 0;
  height: 0;
}

.custom-checkbox {
  width: 18px;
  height: 18px;
  border: 2px solid var(--primary);
  border-radius: 4px;
  margin-right: 8px;
  transition: all 0.2s;
}

.tag-button.active .custom-checkbox {
  border-color: white;
  background: white;
}

.tag-button.active .custom-checkbox::after {
  content: '‚úì';
  position: absolute;
  left: 3px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--primary);
  font-size: 14px;
}

.tag-label {
  font-weight: 500;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.tag-button').forEach(button => {
    const checkbox = button.querySelector('input[type="checkbox"]');
    if(checkbox.checked) {
      button.classList.add('active');
    }
  });
  document.querySelectorAll('.tag-button').forEach(button => {
    button.addEventListener('click', function(e) {
      const checkbox = this.querySelector('input[type="checkbox"]');
      checkbox.checked = !checkbox.checked;
      this.classList.toggle('active', checkbox.checked);
      const event = new Event('change', { bubbles: true });
      checkbox.dispatchEvent(event);
    });
  });
});
</script>
{% endblock %}